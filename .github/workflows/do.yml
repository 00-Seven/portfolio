name: Deploy  on DO Droplet
on:
  push:
    branches: main
jobs:
  deploy:
    runs-on: ubuntu-22.04
    if: github.event_name == 'push'
    steps:
      - name: Deploy to Digital Ocean droplet via SSH action
        uses: appleboy/ssh-action@v0.1.3
        with:
          host: ${{ secrets.DO
          password: ${{ secrets_HOST}}
          username: ${{ secrets.DO_USERNAME }}.DO_KEY}}
          script: |
            #stop all containers:
            docker kill $(docker ps -q)

            #remove all containers
            docker rm $(docker ps -a -q)

            #remove all docker images
            docker rmi $(docker images -q)

            cd portfolio
            git pull
            docker-compose up --build
